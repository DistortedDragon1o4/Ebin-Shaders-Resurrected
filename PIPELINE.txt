The following is a summary of how the pipeline for this shader operates. Specifically, it's a list of the outputs for each program. Some of this information may be out of date or incorrect, but I hope it helps you understand this mess.

GBUFFERS TERRAIN - JUST ALBEDO + DATA
1 solid diffuse
4 solid material ID, nothin', material AO, SSS, normal, lighting data
9 solid smoothness, f0, emission
10 nothing wtf
11 blocklight colour

GBUFFERS WATER - SHADED + DATA
0 transparent nothin', skylight, is water, normal
3 transparent diffuse
8 transparent smoothness, f0
13 transparent sunlight
11 blocklight colour

GBUFFERS TEXTURED - SHADED + DATA
0 transparent nothin', skylight, is water, normal
3 transparent diffuse
8 transparent smoothness, f0
13 transparent sunlight

COMPOSITE0 - GI, AO, VL, COLOURED BLOCKLIGHT, SOLID SUNLIGHT
5 solid GI, AO
6 volumetrics
12 blurred blocklight colour
10 solid sunlight 

COMPOSITE1 - SOLID SHADING
1 solid composite (lit)
4 front material ID, nothin', front sky lighting
6 volumetrics (upscaled)
5 nothing

COMPOSITE2 - REFLECTIONS, SKY BLENDING, TRANSPARENT BLENDING
3 shaded colour
2 material ID

COMPOSITE3 - BLOOM
1 bloom

FINAL - FINAL SHADING
0 final data
